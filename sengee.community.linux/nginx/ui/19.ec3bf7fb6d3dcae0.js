"use strict";(self.webpackChunksengee_ui=self.webpackChunksengee_ui||[]).push([[19],{31962:(R,u,d)=>{d.d(u,{e:()=>$});var _=d(57781),A=d(16817),P=d(40390);let $=(()=>{class c{constructor(){this.scope="",this.svgDasharray="none",this.svgEndCircle={x:0,y:0},this._setGroupEnable=!1,this.setWeightEnable=!1,this.jsonData={}}get setGroupEnable(){return this._setGroupEnable}set setGroupEnable(a){this._setGroupEnable=a,!a&&(this.setWeightEnable=!1)}get svgClass(){return this.mouseoverFlag?c.SVG_HIGHLIGHT_CLASS:c.SVG_NORMAL_CLASS}destroy(){this.from=this.to=this.controlPoints=this.jsonData=this._flowNode=null}initWithFlowPort(a,s){return a.portType===P._.TYPE_IN_PORT&&a.parentFlag===P._.PARENT_FNODE||a.portType===P._.TYPE_OUT_PORT&&a.parentFlag===P._.PARENT_CONTAINER||a.portType===P._.TYPE_TRIGGER_IN_PORT?(this.from=s,this.to=a):(this.from=a,this.to=s),(this.from.portType===P._.TYPE_TRIGGER_IN_PORT||this.from.portType===P._.TYPE_TRIGGER_OUT_PORT)&&(this.svgDasharray=c.SVG_DASHARRAY_TRIGGER),this.from.numConnection++,this.from.flowNode.newFlowPort(this.from),this.to.numConnection++,this.to.flowNode.newFlowPort(this.to),this.updateJsonData(),this}updateOtherInfo(a){return this.group=a.group||a.$_group||"",this.weight=a.weight||a.$_weight||"",this.scope=a.scope||a.$_scope||"",this.checked=a.checked||a.$_checked||"",this}updateJsonData(){let a=this.from.flowNode==this.flowNode?A.j.PARENT:this.from.flowNode.id;this.jsonData.from=`${a}.${this.from.name}`,a=this.to.flowNode==this.flowNode?A.j.PARENT:this.to.flowNode.id,this.jsonData.to=`${a}.${this.to.name}`}get xml(){let a=this.from.flowNode==this.flowNode?A.j.PARENT:this.from.flowNode.id,s=this.to.flowNode==this.flowNode?A.j.PARENT:this.to.flowNode.id,g=this.group?` group="${this.group}"`:"",w=this.weight?` weight="${this.weight}"`:"",N="";return this.controlPoints&&this.controlPoints.map(t=>{N+=`<controlpoint x="${t.x}" y="${t.y}" visible="${t.visible}" percentage="${t.percentage}"/>`}),`<connection from="${a}.${this.from.name}" to="${s}.${this.to.name}"${g}${w}${this.scope?' scope="Def"':""}${this.checked?' checked="true"':""}>${N}</connection>`}get flowNode(){return this._flowNode}set flowNode(a){this._flowNode=a,this.updateJsonData()}mouseover(){this.mouseoverFlag=!0}mouseout(){this.mouseoverFlag=!1}initControlP(a){return a.controlpoint?(Array.isArray(a.controlpoint)||(a.controlpoint=[a.controlpoint]),a.controlpoint.map(s=>{this.controlPoints=[{x:Number(s.$_x),y:Number(s.$_y),visible:(0,_.sw)(s.$_visible),percentage:s.$_percentage}]}),this):this}addControlP(a){if(this.controlPoints)return this.controlPoints[0].visible=!0,void(this.controlPoints=[...this.controlPoints]);this.controlPoints=[{x:this.from.globalX+(this.to.globalX-this.from.globalX)/2,y:this.from.globalY+(this.to.globalY-this.from.globalY)/2,visible:!0,percentage:.5}],this.drawPath()}updateControlP(a=0,s=0){let g=this.controlPoints[0];if("h"===g.flag){if(s<10)return;g.y=s,g.percentage=Math.abs(g.y-this.from.globalY)/Math.abs(this.to.globalY-this.from.globalY)}else{if(a<this.from.globalX+20||a>this.to.globalX-20)return;g.x=a,g.percentage=Math.abs(g.x-this.from.globalX)/Math.abs(this.to.globalX-this.from.globalX)}this.drawPath()}updateControlPByNode(){let a=this.controlPoints[0];"h"===a.flag?a.y<this.from.globalY&&a.y<this.to.globalY||a.y>this.from.globalY&&a.y>this.to.globalY?a.x=this.from.globalX+.5*(this.to.globalX-this.from.globalX):(a.x=this.from.globalX+.5*(this.to.globalX-this.from.globalX),a.y=this.from.globalY+(this.to.globalY-this.from.globalY)*a.percentage):(a.x=this.from.globalX+(this.to.globalX-this.from.globalX)*a.percentage,a.y=this.from.globalY+.5*(this.to.globalY-this.from.globalY))}removeControlP(a){this.controlPoints=null,this.drawPath()}drawPath(a=0,s=0,g=0,w=0,N="",y=!1,O=!1){let t,e,r,i;if(N?(r={x:a,y:s},i={x:g,y:w},y?(t=i)&&(e=r):(t=r)&&(e=i),this.svgEndCircle.x=g,this.svgEndCircle.y=w):(t={x:this.from.globalX,y:this.from.globalY},e={x:this.to.globalX,y:this.to.globalY}),isNaN(t.x)||isNaN(t.y)||isNaN(e.x)||isNaN(e.y))return;let o_x=t.x+(e.x-t.x)/2,o_y=t.y+(e.y-t.y)/2,l=3;if(180*Math.abs(Math.atan((e.y-t.y)/(e.x-t.x)))/Math.PI<=15&&(l=2),e.x<=t.x&&(l=5),this.controlPoints&&(l=6),2===l)this.svgPath=`M${t.x} ${t.y} \n        S${(o_x+t.x)/2} ${t.y} ${o_x} ${o_y}\n        S${(o_x+e.x)/2} ${e.y} ${e.x} ${e.y}`;else if(3===l)this.svgPath=`M${t.x} ${t.y} \n        C${o_x} ${t.y} ${o_x} ${t.y} ${o_x} ${o_y}\n        C${o_x} ${e.y} ${o_x} ${e.y} ${e.x} ${e.y}`;else if(5===l){let n=20,h=t.x+n,T=e.x-n;this.svgPath=`M${t.x} ${t.y} \n        C${h} ${t.y} ${h} ${t.y} ${h} ${(o_y+t.y)/2}\n        C${h} ${o_y} ${h} ${o_y} ${o_x} ${o_y}\n        C${T} ${o_y} ${T} ${o_y} ${T} ${(o_y+e.y)/2}\n        C${T} ${e.y} ${T} ${e.y} ${e.x} ${e.y}`}else if(6===l){O&&this.updateControlPByNode();let n=t.x+20,h=this.controlPoints[0],p=e.x-20;e.x<=t.x?(this.svgPath=`M${t.x} ${t.y} \n          L${n-16} ${t.y}\n          C${n-16} ${t.y} ${n} ${t.y} ${n} ${t.y+16*(h.y>t.y?1:-1)}\n          L${n} ${h.y+16*(h.y>t.y?-1:1)}\n          C${n} ${h.y+16*(h.y>t.y?-1:1)} ${n} ${h.y} ${n-16} ${h.y}\n          L${p+16} ${h.y}\n          C${p+16} ${h.y} ${p} ${h.y} ${p} ${h.y+16*(h.y>e.y?-1:1)}\n          L${p} ${e.y+16*(h.y>e.y?1:-1)}\n          C${p} ${e.y+16*(h.y>e.y?1:-1)} ${p} ${e.y} ${p+16} ${e.y}\n          L${e.x} ${e.y}`,"h"!==h.flag&&(h.percentage=.5),h.flag="h"):(this.svgPath=`M${t.x} ${t.y} \n          L${h.x-16} ${t.y}\n          C${h.x-16} ${t.y} ${h.x} ${t.y} ${h.x} ${t.y+16*(h.y>t.y?1:-1)}\n          L${h.x} ${e.y+16*(h.y>e.y?1:-1)}\n          C${h.x} ${e.y+16*(h.y>e.y?1:-1)} ${h.x} ${e.y} ${h.x+16} ${e.y}\n          L${e.x} ${e.y}`,"v"!==h.flag&&(h.percentage=.5),h.flag="v")}}}return c.SVG_DEBUG_CLASS="debug",c.SVG_NORMAL_CLASS="normal",c.SVG_HIGHLIGHT_CLASS="highlight",c.SVG_DASHARRAY_NONE="none",c.SVG_DASHARRAY_TRIGGER="8,5,3,5",c.SVG_DASHARRAY_TRIGGER1="2,4",c})()},70487:(R,u,d)=>{d.d(u,{k:()=>$});var _=d(57781),A=d(91139),P=d(94865);class ${constructor(){this.lattice=P.g,this.atom=!0}get cx(){return this.x+this.width/2}get cy(){return this.y+this.height/2}get jsonData(){return{id:this.id,name:this.name,x:this.x,y:this.y,width:this.width,height:this.height,parameters:this.parameters}}get graphXml(){var m;const a=this.lattice===P.g?"":` lattice="${this.lattice}"`;return`<fcomment id="${this.id}" name="${this.name}" x="${Math.round(this.x)}" y="${Math.round(this.y)}" width="${Math.round(this.width)}" height="${Math.round(this.height)}"${a}>${(null===(m=this.parameters)||void 0===m?void 0:m.getXml(!1))||""}</fcomment>`}initWithJsonData(m,a=!1){return this.id=m.id||m.$_id||(0,_.Vj)(),this.name=m.name||m.$_name,this.alias=this.name,this.x=Number(m.x||m.$_x)||100,this.y=Number(m.y||m.$_y)||100,this.width=Number(m.width||m.$_width)||200,this.height=Number(m.height||m.$_height)||200,this.lattice=m.lattice||m.$_lattice||P.g,m.parameters&&(this.parameters=A.n.parseParameters(m.parameters,this.id,a)),this}destroy(){}}},16817:(R,u,d)=>{d.d(u,{j:()=>N});var _=d(57781),A=d(65324),P=d(5156),$=d(46055),c=d(91139),m=d(31962),a=d(70487),s=d(40390);class g extends s._{constructor(){super(...arguments),this.width=4,this.height=10}get globalX(){return this.portType===s._.TYPE_TRIGGER_IN_PORT?this.flowNode.x-this.flowNode.innerWidth/2:this.flowNode.x+this.flowNode.innerWidth/2}get globalY(){return this.flowNode.y-this.flowNode.innerHeight/2+10}}var w=d(94865);let N=(()=>{class y{constructor(t=0){this.latticeArr=[],this.level=0,this.pColor=y.P_Color,this.pColor0=y.P_Color,this.bgColor=y.Bg_Color,this.normalBgColor=y.Bg_Color,this.selectedColor=y.Selected_Color,this.width=100,this.height=100,this.innerWidth=80,this.innerX=10,this.innerY=10,this.inportArr=[],this.outportArr=[],this.triggerInportArr=[],this.triggerOutportArr=[],this.mappingKNameVFlowPort={},this.subFlowNodeArr=[],this.parentFlowNode=null,this.connectionArr=[],this.commentArr=[],this.tagArr=[],this.level=t,this.initTriggerPort()}get type(){return this._type}set type(t){this._type=t,this.pColor=P.M6[this._type]||y.P_Color,this.pColor0=(0,_.PS)(this.pColor,.4);const e=(0,_.Nz)(this.pColor,"array");this.bgColor=this.normalBgColor=`hsl(${e[0]}, ${e[1]}%, 95%)`,this.selectedColor=`hsl(${e[0]}, ${e[1]}%, 85%)`}get visible(){var t;return this.level===(null===(t=this.flowService)||void 0===t?void 0:t.currentLevel)}get innerHeight(){const t=Math.max(this.inportArr.length,this.outportArr.length);return t<=3?80:20*(t-3)+80}get outArr(){return this.outportArr.filter(t=>t.isOut)}get resultArr(){return this.outportArr.filter(t=>t.isResult)}get jsonData(){return{id:this.id,name:this.name,alias:this.alias||this.name,version:this.version,breaker:this.breaker,atom:this.atom,replica:this.replica,x:this.x||0,y:this.y||0,lattice:this.lattice,lattices:this.latticeArr&&this.latticeArr.length>1?this.latticeArr.map(t=>t.name).join(","):"",parameters:this.parameters,inport:this.inportArr.map(t=>t.jsonData),outport:this.outportArr.map(t=>t.jsonData),fnode:this.subFlowNodeArr.map(t=>t.jsonData),connect:this.connectionArr.map(t=>t.jsonData),fcomment:this.commentArr.map(t=>t.jsonData),tags:this.tagArr}}get graphXml(){let t=this.parameters?this.parameters.getXml():"",e="";this.inportArr.map(p=>{e+=p.xml});let r="";this.outportArr.map(p=>{r+=p.xml});let i="";this.subFlowNodeArr.map(p=>{i+=p.graphXml});let o="";this.connectionArr.map(p=>{o+=p.xml});let f="";this.commentArr.map(p=>{f+=p.graphXml});let l="";this.tagArr&&this.tagArr.length&&(l="<tags>",this.tagArr.map(p=>{l+=`<tag name="${p.name}" value="${p.value}" />`}),l+="</tags>");let n=this.lattice!==w.g?` lattice="${this.lattice}"`:"",h=this.latticeArr&&this.latticeArr.length>1?` lattices="${this.latticeArr.map(p=>p.name).join(",")}"`:"";return`<fnode id="${this.id}" name="${this.name}" alias="${this.alias||this.name}" atom="${this.atom}" x="${Math.round(this.x)||0}" y="${Math.round(this.y)||0}" replica="${this.replica}"${h}${n}>${t}${e}${r}${i}${o}${f}${l}</fnode>`}get formatXml(){return(0,_.t6)(this.graphXml)}destroy(){this.inportArr.map(t=>t.destroy()),this.outportArr.map(t=>t.destroy()),this.subFlowNodeArr.map(t=>t.destroy()),this.connectionArr.map(t=>t.destroy()),this.commentArr.map(t=>t.destroy()),this.latticeArr.map(t=>t.destroy()),this.parameters=this.flowService=this.inportArr=this.outportArr=this.mappingKNameVFlowPort=this.connectionArr=this.commentArr=this.latticeArr=null}setFlowService(t){return this.flowService=t,this}initTriggerPort(){this.addFlowPort((new g).initWithJsonData({name:s._.TYPE_TRIGGER_IN_PORT,portType:s._.TYPE_TRIGGER_IN_PORT})),this.addFlowPort((new g).initWithJsonData({name:s._.TYPE_TRIGGER_OUT_PORT,portType:s._.TYPE_TRIGGER_OUT_PORT}))}initWithJsonData(t){if(!t)return this;this.id=t.id||t.$_id||(0,_.Vj)(),this.name=t.name||t.$_name,this.alias=t.alias||t.$_alias||this.name,this.version=t.version,this.breaker=t.breaker,this.atom=(0,_.or)((0,_.or)(t.atom,t.$_atom),!0),this.replica=Number(t.replica||t.$_replica||1),("ProcessOperator"===this.name||"ProcessReference"===this.name)&&(this.atom=!1),this.x=Number(t.x||t.$_x)||130,this.y=Number(t.y||t.$_y)||130,this.lattice=t.lattice||t.$_lattice||w.g,t.parameters&&(this.parameters=c.n.parseParameters(t.parameters,this.id,!1));const e=t.lattices||t.$_lattices;if(e?e.split(",").map(r=>{this.latticeArr.push(new w.z(r).setNode(this))}):this.atom||this.latticeArr.push((new w.z).setNode(this)),t.tags&&t.tags.tag?(this.tagArr=Array.isArray(t.tags.tag)?t.tags.tag:[t.tags.tag],this.tagArr.map(r=>{r.name=r.name||r.$_name,r.value=r.value||r.$_value,"type"===r.name&&(this.type=r.value)})):Object.keys(P.M6).map(r=>{-1===this.name.indexOf(r)||(this.type=r)}),t.inport&&(Array.isArray(t.inport)||(t.inport=[t.inport]),t.inport.map(r=>{r.portType=s._.TYPE_IN_PORT,this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData(r))})),t.outport&&(Array.isArray(t.outport)||(t.outport=[t.outport]),t.outport.map(r=>{r.portType=s._.TYPE_OUT_PORT,this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData(r))})),t.fnode&&(Array.isArray(t.fnode)||(t.fnode=[t.fnode]),t.fnode.map(r=>{this.addSubFlowNode(new y(this.level+1).setFlowService(this.flowService).initWithJsonData(r))})),t.fcomment&&(Array.isArray(t.fcomment)||(t.fcomment=[t.fcomment]),t.fcomment.map(r=>{this.addComment((new a.k).initWithJsonData(r))})),!t.connect&&!t.connection)return this;t.connect=t.connection||t.connect,Array.isArray(t.connect)||(t.connect=[t.connect]);for(let r of t.connect){let i=(r.from||r.$_from).split("."),o=(r.to||r.$_to).split("."),f=i[0],l=i[1],n=o[0],h=o[1],p=f===y.PARENT?this:this.getSubFlowNodeById(f),T=n===y.PARENT?this:this.getSubFlowNodeById(n);if(!p||!T)continue;let b=p.getFlowPortByName(l),x=T.getFlowPortByName(h);b.parentFlag=p===this?s._.PARENT_CONTAINER:s._.PARENT_FNODE,x.parentFlag=T===this?s._.PARENT_CONTAINER:s._.PARENT_FNODE,this.addConnection((new m.e).initWithFlowPort(b,x).initControlP(r).updateOtherInfo(r))}return this}initWithOperator(t,e=!0){if(this.id=(0,_.Vj)(),this.name=t.name||t.$_name,this.alias=t.i18nText||t.alias||t.$_alias||this.name,this.atom=(0,_.or)((0,_.or)(t.atom,t.$_atom),!0),this.replica=Number(t.replica||t.$_replica||1),("ProcessOperator"===this.name||"ProcessReference"===this.name)&&(this.atom=!1),this.resourceType=t.resourceType,this.resourceType===$.b0.PrcGraph&&(this.flowId=t.id)&&(this.flowName="ProcessReference"),e){let r,i;if(this.type=t.type,this.tagArr.push({name:"type",value:this.type}),t.inputPorts){try{r=JSON.parse(t.inputPorts)}catch(o){r=t.inputPorts}r.map(o=>{o.portType=s._.TYPE_IN_PORT,this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData(o))})}if(t.outputPorts){try{i=JSON.parse(t.outputPorts)}catch(o){i=t.outputPorts}i.map(o=>{o.portType=s._.TYPE_OUT_PORT,this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData(o))})}}else t.inport&&(!Array.isArray(t.inport)&&(t.inport=[t.inport]),t.inport.map(r=>{r.portType=s._.TYPE_IN_PORT,this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData(r))})),t.outport&&(!Array.isArray(t.outport)&&(t.outport=[t.outport]),t.outport.map(r=>{r.portType=s._.TYPE_OUT_PORT,this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData(r))}));return t.parameters&&(this.parameters=c.n.parseParameters(t.parameters,this.id,e)),t.lattices?t.lattices.split(",").map(r=>{this.latticeArr.push(new w.z(r).setNode(this))}):this.atom||this.latticeArr.push((new w.z).setNode(this)),this}newFlowPort(t){const e=t.parentFlag===s._.PARENT_FNODE?t.dataType:"/";if(t.portType===s._.TYPE_IN_PORT)t.extendable&&!this.inportArr.find(r=>r.numConnection<=0)&&(this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData({name:this.generateInportName(t.name),portType:s._.TYPE_IN_PORT,dataType:e,type:t.type,option:t.option,extendable:t.extendable,connectionLimit:t.connectionLimit})),this.drawPathByFlowPort());else if(t.portType===s._.TYPE_OUT_PORT){const r=t.isOut?this.outArr:this.resultArr;t.extendable&&!r.find(i=>i.numConnection<=0)&&(this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData({name:this.generateOutportName(r,t.name),portType:s._.TYPE_OUT_PORT,dataType:e,type:t.type,option:t.option,extendable:t.extendable,connectionLimit:t.connectionLimit})),this.drawPathByFlowPort())}}generateInportName(t){var e;t=null===(e=t.match(/[a-zA-Z]+/))||void 0===e?void 0:e[0];let r=1;return this.inportArr.map(i=>{let o=Number(i.name.replace(t,""));!isNaN(o)&&o>=r&&(r=o+1)}),t+r}generateOutportName(t,e){var r;e=null===(r=e.match(/[a-zA-Z]+/))||void 0===r?void 0:r[0];let i=1;return t.map(o=>{let f=Number(o.name.replace(e,""));!isNaN(f)&&f>=i&&(i=f+1)}),e+i}drawPathByFlowPort(){setTimeout(()=>{this.connectionArr&&this.connectionArr.map(t=>t.drawPath())})}addFlowPort(t){if(!t||this.mappingKNameVFlowPort[t.name])return t;switch(t.flowNode&&t.flowNode.removeFlowPort(t),t.flowNode=this,this.mappingKNameVFlowPort[t.name]=t,t.portType){case s._.TYPE_IN_PORT:this.inportArr=[...this.inportArr,t];break;case s._.TYPE_OUT_PORT:this.outportArr=[...this.outportArr,t];break;case s._.TYPE_TRIGGER_IN_PORT:this.triggerInportArr=[...this.triggerInportArr,t];break;case s._.TYPE_TRIGGER_OUT_PORT:this.triggerOutportArr=[...this.triggerOutportArr,t]}return t}removeFlowPort(t){if(!t||!this.mappingKNameVFlowPort[t.name])return t;switch(t.flowNode=null,delete this.mappingKNameVFlowPort[t.name],t.portType){case s._.TYPE_IN_PORT:this.inportArr=this.inportArr.filter((e,r)=>r!==this.inportArr.indexOf(t)),this.drawPathByFlowPort();break;case s._.TYPE_OUT_PORT:this.outportArr=this.outportArr.filter((e,r)=>r!==this.outportArr.indexOf(t)),this.drawPathByFlowPort();break;case s._.TYPE_TRIGGER_IN_PORT:this.triggerInportArr=this.triggerInportArr.filter((e,r)=>r!==this.triggerInportArr.indexOf(t));break;case s._.TYPE_TRIGGER_OUT_PORT:this.triggerOutportArr=this.triggerOutportArr.filter((e,r)=>r!==this.triggerOutportArr.indexOf(t))}return t.destroy(),t}addFlowPortByAlias(t,e=""){let r,i,o,f,l;e===s._.TYPE_IN_PORT?(r=this.inportArr,o=r[r.length-1],i=this.generateInportName(o.name),l=s._.TYPE_IN_PORT):e===s._.TYPE_RESULT_PORT?(r=this.resultArr,o=r[r.length-1],i=this.generateOutportName(r,o.name),l=s._.TYPE_OUT_PORT):(r=this.outArr,o=r[r.length-1],i=this.generateOutportName(r,o.name),l=s._.TYPE_OUT_PORT),o&&(f=o.parentFlag===s._.PARENT_FNODE?o.dataType:"/",this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData({name:i,alias:t,portType:l,dataType:f,option:o.option,extendable:o.extendable,connectionLimit:o.connectionLimit})))}removeFlowPortByAlias(t,e=""){let r,i;r=e===s._.TYPE_IN_PORT?this.inportArr:e===s._.TYPE_RESULT_PORT?this.resultArr:this.outArr,i=r.find(o=>o.alias===t),i&&(i.numConnection>0&&this.parentFlowNode.connectionArr.filter(o=>o.from===i||o.to===i).map(o=>{this.parentFlowNode.removeConnection(o)}),i.breakpoint&&this.flowService.notify.notify(A.gh.DeleteBreakpointWhenDeletePort,i.breakpoint),this.removeFlowPort(i))}renameFlowPort(t,e,r=""){let i,o;i=r===s._.TYPE_IN_PORT?this.inportArr:r===s._.TYPE_RESULT_PORT?this.resultArr:this.outArr,o=i.find(f=>f.alias===t),o&&(o.alias=e)}updateFlowPortByParameter(t){const e=l=>{l.map(n=>{n.numConnection>0&&this.parentFlowNode.connectionArr.filter(h=>h.from===n||h.to===n).map(h=>{this.parentFlowNode.removeConnection(h)}),n.breakpoint&&this.flowService.notify.notify(A.gh.DeleteBreakpointWhenDeletePort,n.breakpoint),n.flowNode=null,delete this.mappingKNameVFlowPort[n.name],this.outportArr=this.outportArr.filter((h,p)=>p!==this.outportArr.indexOf(n)),n.destroy()})};if(!t||!t.value)return void e(this.outportArr.concat([]));const i=this.outportArr.filter(l=>t.value.find(n=>l.name===n.portName.value)),o=this.outportArr.filter(l=>-1===i.indexOf(l)),f=t.value.filter(l=>!i.find(n=>n.name===l.portName.value));e(o),(l=>{l.map(n=>{this.addFlowPort((new s._).setFlowService(this.flowService).initWithJsonData({name:n.portName.value,flowDataType:n.flowDataType.value,portType:s._.TYPE_OUT_PORT,option:!0}))})})(f)}getFlowPortByName(t){return this.mappingKNameVFlowPort[t]}addSubFlowNode(t){return!t||-1!==this.subFlowNodeArr.indexOf(t)||(t.parentFlowNode&&t.parentFlowNode.removeSubFlowNode(t),t.parentFlowNode=this,this.subFlowNodeArr=[...this.subFlowNodeArr,t]),t}removeSubFlowNode(t){return!t||-1===this.subFlowNodeArr.indexOf(t)||(t.parentFlowNode=null,this.subFlowNodeArr=this.subFlowNodeArr.filter((e,r)=>r!==this.subFlowNodeArr.indexOf(t)),t.inportArr.map(e=>{e.breakpoint&&this.flowService.notify.notify(A.gh.DeleteBreakpointWhenDeletePort,e.breakpoint)}),t.outportArr.map(e=>{e.breakpoint&&this.flowService.notify.notify(A.gh.DeleteBreakpointWhenDeletePort,e.breakpoint)}),t.destroy()),t}getSubFlowNodeById(t){return this.subFlowNodeArr.find(e=>e.id===t)}getFromFlowNodes(t,e=""){let o,r=this.getSubFlowNodeById(t),i=[];return r&&(o=r.inportArr.filter(f=>f.numConnection),e&&(o=o.filter(f=>0===f.dataType.indexOf(e))),o.map(f=>{this.connectionArr.map(l=>{l.to===f&&i.push(l.from.flowNode)})})),i}getToFlowNodes(t){let e=this.getSubFlowNodeById(t),r=[];return e&&e.outportArr.filter(i=>i.numConnection).map(i=>{this.connectionArr.map(o=>{o.from===i&&r.push(o.to.flowNode)})}),r}getTreeNode(){return{title:this.alias,name:this.name,key:this.id,isLeaf:!0}}getFlowTree(){let t=this.getTreeNode();return this.subFlowNodeArr.length&&(t.isLeaf=!1,t.children=[],this.subFlowNodeArr.map(e=>{t.children.push(e.getFlowTree())})),t}addConnection(t){return!t||-1!==this.connectionArr.indexOf(t)||(t.flowNode&&t.flowNode.removeConnection(t),t.flowNode=this,this.connectionArr=[...this.connectionArr,t],setTimeout(()=>{t.drawPath()}),this.updatePortDataType(t),this.updateConnectionType()),t}removeConnection(t){if(!t||-1===this.connectionArr.indexOf(t))return t;if(t.flowNode=null,t.from.numConnection--,t.from.connectionScope="",t.to.numConnection--,t.to.connectionScope="",this.connectionArr=this.connectionArr.filter((e,r)=>r!==this.connectionArr.indexOf(t)),t.from.numConnection<=0){let e=t.from.flowNode;t.from.extendable&&e.removeFlowPort(t.from),t.from.flowMeta=""}if(t.to.numConnection<=0){let e=t.to.flowNode;t.to.extendable&&e.removeFlowPort(t.to),t.to.flowMeta=""}return this.updatePortDataType(t),this.updateConnectionType(),t.destroy(),t}getConnection(t,e){return this.connectionArr.find(r=>r.from===t&&r.to===e||r.from===e&&r.to===t)}addComment(t){return!t||-1!==this.commentArr.indexOf(t)||(this.commentArr=[...this.commentArr,t]),t}removeComment(t){return!t||-1===this.commentArr.indexOf(t)||(this.commentArr=this.commentArr.filter((e,r)=>r!==this.commentArr.indexOf(t))),t}updateConnectionType(){this.subFlowNodeArr.map(t=>{var e;(null===(e=t.outportArr.find(r=>"pazOut"===r.name))||void 0===e?void 0:e.numConnection)?this.connectionArr.filter(r=>"pazOut"!==r.from.name&&"pazOut"!==r.to.name).filter(r=>"Def"!==r.scope).map(r=>{(r.from.flowNode===t||r.to.flowNode===t)&&(r.svgDasharray=m.e.SVG_DASHARRAY_TRIGGER1,r.scope=r.from.connectionScope=r.to.connectionScope="Def")}):t.inportArr.some(i=>"Def"===i.connectionScope)&&t.outportArr.some(i=>"Def"===i.connectionScope)&&this.connectionArr.filter(i=>"pazOut"!==i.from.name&&"pazOut"!==i.to.name).filter(i=>"Def"!==i.scope).map(i=>{(i.from.flowNode===t||i.to.flowNode===t)&&(i.svgDasharray=m.e.SVG_DASHARRAY_TRIGGER1,i.scope=i.from.connectionScope=i.to.connectionScope="Def")})})}updatePortDataType(t){this.parentFlowNode||t.from.parentFlag===s._.PARENT_FNODE&&t.to.parentFlag===s._.PARENT_FNODE||(this.inportArr.map(e=>{e.dataType="/"}),this.inportArr.filter(e=>e.numConnection>0).map(e=>{this.connectionArr.filter(i=>i.from===e).map(i=>i.to).map(i=>{e.dataType=e.dataType.length>i.dataType.length?e.dataType:i.dataType})}),this.outportArr.map(e=>{e.dataType="/"}),this.outportArr.filter(e=>e.numConnection>0).map(e=>{const r=this.connectionArr.filter(i=>i.to===e).map(i=>i.from);1===r.length?e.dataType=r[0].dataType:r.map(i=>{e.dataType=e.dataType.length>i.dataType.length?i.dataType:e.dataType})}))}}return y.PARENT="parent",y.P_Color="#2a8b92",y.Bg_Color="#fbffff",y.Selected_Color="#d9fbfd",y})()}}]);